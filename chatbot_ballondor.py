# -*- coding: utf-8 -*-
"""chatbot_ballondor.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kZW8P3P-1ICdawztOa2j-dmuNrID-zLT
"""

import streamlit as st
import pandas as pd
from transformers import pipeline

# Charger les donnÃ©es filtrÃ©es depuis un fichier CSV
@st.cache_data
def load_data():
    data = pd.read_csv('Ballondor2024.csv')  # Remplacez par le chemin de votre fichier CSV
    return data

# Charger le modÃ¨le de langage
@st.cache_resource
def load_model():
    return pipeline("text-generation", model="EleutherAI/gpt-neo-125M")

# RÃ©cupÃ©rer l'URL des moments forts d'un joueur
def get_highlight_url(player_name, data):
    player_data = data[data['player'].str.contains(player_name, case=False, na=False)]
    if not player_data.empty:
        return player_data['URL'].values[0]  # Retourne la premiÃ¨re URL trouvÃ©e
    else:
        return None

# Charger les donnÃ©es et le modÃ¨le
data = load_data()
model = load_model()

# Interface Streamlit
st.title("ğŸ† Chatbot Ballon d'Or 2024")
st.write("Posez des questions sur les nominÃ©s, dÃ©couvrez leurs performances et regardez leurs meilleurs moments !")

# **Section 1 : Question gÃ©nÃ©rale sur le Ballon d'Or**
st.header("â“ Poser une question gÃ©nÃ©rale")
question = st.text_input("Entrez votre question :")

if question:
    # GÃ©nÃ©rer une rÃ©ponse avec le modÃ¨le
    with st.spinner("Le chatbot rÃ©flÃ©chit..."):
        response = model(question, max_length=50)[0]['generated_text']
    st.write("ğŸ’¬ RÃ©ponse du Chatbot :")
    st.write(response)

# **Section 2 : Recherche des moments forts d'un joueur**
st.header("ğŸ¥ Moments forts d'un joueur")
player_name = st.text_input("Recherchez un joueur par son nom :")

if player_name:
    highlight_url = get_highlight_url(player_name, data)
    if highlight_url:
        st.video(highlight_url)  # IntÃ©grer la vidÃ©o directement
        st.write(f"Regardez les moments forts de **{player_name}** ici : [Lien direct]({highlight_url})")
    else:
        st.write("âŒ Aucune vidÃ©o trouvÃ©e pour ce joueur. VÃ©rifiez l'orthographe ou essayez un autre nom.")

# **Section 3 : Explorateur de joueurs**
st.header("ğŸ“Š Explorateur des statistiques")
st.write("DÃ©couvrez les statistiques des joueurs nominÃ©s au Ballon dâ€™Or 2024.")

# SÃ©lection d'un joueur dans un menu dÃ©roulant
player_list = data['player'].unique()
selected_player = st.selectbox("SÃ©lectionnez un joueur :", player_list)

if selected_player:
    player_stats = data[data['player'] == selected_player].iloc[0]  # RÃ©cupÃ¨re les stats du joueur sÃ©lectionnÃ©
    st.subheader(f"Statistiques de {selected_player}")
    st.write("ğŸŸï¸ Ã‰quipe :", player_stats['team'])
    st.write("ğŸŒ Nation :", player_stats['nation'])
    st.write("âš½ Buts :", player_stats['Performance-Gls'])
    st.write("ğŸ¯ Passes dÃ©cisives :", player_stats['Performance-Ast'])
    st.write("ğŸ“Š xG attendu :", player_stats['Expected-xG'])
    st.write("ğŸš« Cartons jaunes :", player_stats['Performance-CrdY'])
    st.write("ğŸŸ¥ Cartons rouges :", player_stats['Performance-CrdR'])

    # Affichage vidÃ©o, si disponible
    if pd.notna(player_stats['URL']):
        st.video(player_stats['URL'])
        st.write(f"ğŸ¥ Moments forts de **{selected_player}** : [Lien direct]({player_stats['URL']})")

# **Footer**
st.write("---")
st.write("âš¡ Chatbot rÃ©alisÃ© avec Streamlit et Hugging Face Transformers. DonnÃ©es issues du fichier `Ballondor2024.csv`.")